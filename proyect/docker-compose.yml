services:
       - "5432:5432" 
     volumes:
       - pgdata:/var/lib/postgresql/data
     healthcheck: 
       test: ["CMD-SHELL", "pg_isready -U ${POSTGRES_USER:-telemetry} -d ${POSTGRES_DB:-tele>
       interval: 5s
       timeout: 3s
       retries: 20
 
   api:
     environment:
       PYTHONPATH: /app
   
     build: .
     env_file:
       - .env
     depends_on: 
       db:
         condition: service_healthy
     ports: 
       - "8000:8000"
     volumes:
       - ./app:/app/app
       - ./tests:/app/tests
     command: > 
+      bash -c "alembic upgrade head && uvicorn app.main:app --host 0.0.0.0 --port 8000 --reload"
 
 volumes:
   pgdata:
 
